name: Build & Release Dolby Unified Player APK  on:   push:     branches: [main]   workflow_dispatch:  jobs:   build-apk:     name: Build Signed Release APK     runs-on: ubuntu-latest      steps:       # ── 1. Checkout ──────────────────────────────────────────────       - name: Checkout repository         uses: actions/checkout@v4        # ── 2. Node.js ───────────────────────────────────────────────       - name: Set up Node.js 20         uses: actions/setup-node@v4         with:           node-version: '20'           cache: 'npm'        # ── 3. Java 17 ───────────────────────────────────────────────       - name: Set up JDK 17         uses: actions/setup-java@v4         with:           distribution: 'temurin'           java-version: '17'        # ── 4. Android SDK ───────────────────────────────────────────       - name: Set up Android SDK         uses: android-actions/setup-android@v3         with:           api-level: 34           build-tools: '34.0.0'           ndk: false        # ── 5. Install dependencies ──────────────────────────────────       - name: Install npm dependencies         run: npm ci        # ── 6. Sync Capacitor → Android ──────────────────────────────       - name: Capacitor sync         run: npx cap sync android        # ── 7. Gradle permissions ────────────────────────────────────       - name: Make gradlew executable         run: chmod +x android/gradlew        # ── 8. Decode keystore from GitHub Secret ────────────────────       - name: Decode release keystore         env:           KEYSTORE_BASE64: ${{ secrets.KEYSTORE_BASE64 }}         run: |           echo "$KEYSTORE_BASE64" | base64 --decode > android/app/dolby-release.jks        # ── 9. Build signed release APK ──────────────────────────────       - name: Build release APK         working-directory: android         env:           KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}           KEY_ALIAS:         ${{ secrets.KEY_ALIAS }}           KEY_PASSWORD:      ${{ secrets.KEY_PASSWORD }}         run: |           ./gradlew assembleRelease \             -Pandroid.injected.signing.store.file=$GITHUB_WORKSPACE/android/app/dolby-release.jks \             -Pandroid.injected.signing.store.password=$KEYSTORE_PASSWORD \             -Pandroid.injected.signing.key.alias=$KEY_ALIAS \             -Pandroid.injected.signing.key.password=$KEY_PASSWORD        # ── 10. Rename APK ────────────────────────────────
- name: Rename APK         run: |           mv android/app/build/outputs/apk/release/app-release.apk \              android/app/build/outputs/apk/release/DolbyUnifiedPlayer.apk        # ── 11. Upload APK as workflow artifact ──────────────────────       - name: Upload APK artifact         uses: actions/upload-artifact@v4         with:           name: DolbyUnifiedPlayer-APK           path: android/app/build/outputs/apk/release/DolbyUnifiedPlayer.apk           retention-days: 30        # ── 12. Create GitHub Release with APK attached ──────────────       - name: Get version from package.json         id: version         run: echo "VERSION=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT        - name: Create GitHub Release         uses: softprops/action-gh-release@v2         with:           tag_name: v${{ steps.version.outputs.VERSION }}-build${{ github.run_number }}           name: "Dolby Unified Player v${{ steps.version.outputs.VERSION }} (Build ${{ github.run_number }})"           body: |             ## Dolby Unified Player — Automated Release              **Build:** #${{ github.run_number }}             **Commit:** ${{ github.sha }}             **Branch:** ${{ github.ref_name }}              ### Included             - Full Dolby On DSP chain (Style / NR / Tone / Boost)             - Dolby Atmos 9.2.4 HRTF spatial engine (7 modes)             - Parametric EQ 3Hz–45kHz             - 384kHz / 32-bit WAV export (192kHz fallback)             - Streaming: Spotify · Tidal · Deezer · Apple Music · YouTube             - Local library scanner + drag & drop              ### Install             Download `DolbyUnifiedPlayer.apk` below and sideload, or distribute via Play Store.           files: android/app/build/outputs/apk/release/DolbyUnifiedPlayer.apk           draft: false           prerelease: false         env:           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
